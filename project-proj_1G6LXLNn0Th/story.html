<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>创作故事 - 儿童AI故事绘画</title>
    <meta name="description" content="与AI互动创作专属故事">
    <meta name="keywords" content="儿童绘画,AI故事,创意表达,智能互动,语音交互">
    <meta property="og:title" content="创作故事 - 儿童AI故事绘画">
    <meta property="og:description" content="与AI互动创作专属故事">
    <meta name="twitter:title" content="创作故事 - 儿童AI故事绘画">
    <meta name="twitter:description" content="与AI互动创作专属故事">

    <script src="https://resource.trickle.so/vendor_lib/unpkg/react@18/umd/react.production.min.js"></script>
    <script src="https://resource.trickle.so/vendor_lib/unpkg/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://resource.trickle.so/vendor_lib/unpkg/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://resource.trickle.so/vendor_lib/unpkg/lucide-static@0.516.0/font/lucide.css" rel="stylesheet">
    <link href="./styles/hand-drawn.css" rel="stylesheet">
    <script src="https://unpkg.com/wavesurfer.js@7.8.6/dist/wavesurfer.umd.min.js"></script>

    <style>
    /* 直接应用手绘风格 */
    body {
        font-family: 'Kalam', cursive !important;
        background-color: var(--paper-white) !important;
        background-image: 
            radial-gradient(circle at 20% 80%, rgba(107, 115, 255, 0.05) 0%, transparent 50%),
            radial-gradient(circle at 80% 20%, rgba(233, 30, 99, 0.05) 0%, transparent 50%),
            radial-gradient(circle at 40% 40%, rgba(46, 204, 113, 0.03) 0%, transparent 50%),
            radial-gradient(circle at 60% 70%, rgba(243, 156, 18, 0.04) 0%, transparent 50%) !important;
        color: var(--text-sketch) !important;
    }
    
    h1, h2, h3 {
        font-family: 'Caveat', cursive !important;
        font-weight: 600 !important;
        color: var(--sketch-blue) !important;
        text-shadow: 1px 1px 2px rgba(107, 115, 255, 0.1) !important;
    }

    .btn-primary, .sketch-btn-primary {
        font-family: 'Kalam', cursive !important;
        font-weight: 400 !important;
        padding: 12px 24px !important;
        border: 3px solid currentColor !important;
        border-radius: 20px 15px 18px 22px !important;
        background: linear-gradient(145deg, var(--sketch-blue), var(--sketch-purple)) !important;
        color: white !important;
        border-color: var(--sketch-blue) !important;
        position: relative !important;
        cursor: pointer !important;
        transition: all 0.3s ease !important;
        transform: rotate(-0.5deg) !important;
        box-shadow: var(--sketch-shadow) !important;
    }
    
    .btn-secondary, .sketch-btn-secondary {
        font-family: 'Kalam', cursive !important;
        font-weight: 400 !important;
        padding: 12px 24px !important;
        border: 3px solid currentColor !important;
        border-radius: 20px 15px 18px 22px !important;
        background: linear-gradient(145deg, var(--sketch-orange), var(--sketch-yellow)) !important;
        color: white !important;
        border-color: var(--sketch-orange) !important;
        position: relative !important;
        cursor: pointer !important;
        transition: all 0.3s ease !important;
        transform: rotate(-0.5deg) !important;
        box-shadow: var(--sketch-shadow) !important;
    }
    
    .card, .sketch-card {
        background: var(--paper-white) !important;
        border: 2px solid var(--sketch-blue) !important;
        border-radius: 20px 15px 18px 25px !important;
        padding: 20px !important;
        position: relative !important;
        box-shadow: var(--sketch-shadow) !important;
        transform: rotate(-0.3deg) !important;
    }
    
    /* 移除卡片额外边框，防止重叠
    .card::before, .sketch-card::before {
        content: '' !important;
        position: absolute !important;
        top: -3px !important;
        left: -3px !important;
        right: -3px !important;
        bottom: -3px !important;
        border: 1px solid var(--sketch-pink) !important;
        border-radius: 18px 20px 15px 22px !important;
        transform: rotate(0.6deg) !important;
        z-index: -1 !important;
        opacity: 0.4 !important;
    }
    */
    
    /* 确保所有文本都应用手绘字体 */
    * {
        font-family: 'Kalam', cursive !important;
    }
    
    h1, h2, h3, h4, h5, h6 {
        font-family: 'Caveat', cursive !important;
    }
    </style>

</head>
<body>
    <div id="root"></div>
    
    <!-- 按照Step-Realtime-Console的方式加载实时语音库 -->
    <script type="module">
      try {
        // 预加载必需的模块
        const realtimeModule = await import('./lib/openai-realtime-api-beta/index.js');
        const wavtoolsModule = await import('./lib/wavtools/index.js');
        
        // 将类挂载到window对象上供其他脚本使用
        window.RealtimeClient = realtimeModule.RealtimeClient;
        window.WavRecorder = wavtoolsModule.WavRecorder;
        window.WavStreamPlayer = wavtoolsModule.WavStreamPlayer;
        
        console.log('✅ 实时语音库加载成功');
        console.log('- RealtimeClient:', !!window.RealtimeClient);
        console.log('- WavRecorder:', !!window.WavRecorder);
        console.log('- WavStreamPlayer:', !!window.WavStreamPlayer);
        
        // 触发自定义事件，通知组件库已加载
        window.dispatchEvent(new CustomEvent('realtimeLibrariesLoaded'));
        
      } catch (error) {
        console.error('❌ 实时语音库加载失败:', error);
        // 显示错误提示
        document.getElementById('root').innerHTML = `
          <div style="
            display: flex; 
            align-items: center; 
            justify-content: center; 
            min-height: 100vh; 
            background: #FFF8F3;
            font-family: sans-serif;
          ">
            <div style="
              background: white; 
              padding: 2rem; 
              border-radius: 16px; 
              box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
              max-width: 400px;
              text-align: center;
            ">
              <h2 style="color: #dc2626; margin-bottom: 1rem;">语音库加载失败</h2>
              <p style="color: #7F8C8D; margin-bottom: 1.5rem;">
                实时语音功能无法加载，请检查网络连接后刷新页面。
              </p>
              <button 
                onclick="window.location.reload()" 
                style="
                  background: #FF6B6B; 
                  color: white; 
                  padding: 0.75rem 1.5rem; 
                  border: none; 
                  border-radius: 8px; 
                  cursor: pointer;
                  font-weight: 600;
                "
              >
                重新加载
              </button>
            </div>
          </div>
        `;
      }
    </script>
    
    <!-- Components -->
    <script type="text/babel" src="components/ErrorBoundary.js"></script>
    <script type="text/babel" src="components/Header.js"></script>
    <script type="text/babel" src="components/ImageUpload.js"></script>
    <script type="text/babel" src="components/RealtimeVoiceChat.js"></script>
    <script type="text/babel" src="components/AIResponse.js"></script>
    <script type="text/babel" src="components/StoryDisplay.js"></script>
    <script type="text/babel" src="components/ImageGallery.js"></script>
    <script type="text/babel" src="components/ImageModal.js"></script>

    <!-- Utils -->
    <script type="text/babel" src="utils/cryptoHelper.js"></script>
    <script type="text/babel" src="utils/fallbackSpeechService.js"></script>
    <script type="text/babel" src="utils/aiService.js"></script>
    <script type="text/babel" src="utils/imageSearchService.js"></script>
    
    <!-- Story App -->
    <script type="text/babel" src="story-app.js"></script>
</body>
</html>